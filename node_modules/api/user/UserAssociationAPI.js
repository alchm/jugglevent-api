if (typeof define !== 'function') {
    var define = require('amdefine')(module);
}

define([
    'mongoose'
], function (mongoose) {

    var exports     = {},
        User        = mongoose.model('User'),
        Association = mongoose.model('Association');

    exports.getById = function (userId, associationId, done) {
        User.findOne({ _id: userId })
            .populate({ path: 'associations',
                        match: { _id: associationId } })
            .exec( function (err, data) {
                if (!err) {
                    if (data) done(null, data);
                    else done(new Error('No result'), null);
                } else done(err, null);
            });
    };

    return exports;

});